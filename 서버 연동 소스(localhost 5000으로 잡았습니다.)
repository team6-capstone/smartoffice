const fs=require('fs')
const express = require('express');
const bodyParser=require('body-parser');
const app=express();
const port=process.env.PORT || 5000;

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({extended:true}));

const data=fs.readFileSync('./database.json');
const conf=JSON.parse(data);
const mysql=require('mysql');
const connection=mysql.createConnection({
   host: conf.host,
   user: conf.user,
   password: conf.password,
   port : conf.port,
   database : conf.database
});
connection.connect();
app.get('/api/hello', (req, res)=> {
  connection.query(
    "SELECT * FROM user",
    (err, rows, fields) => {
       res.send(rows);
    }
  );
});

app.post('/api/hello', (req, res)=>{
 
  let name=req.body.name;
  let id=req.body.id;
  let pw=req.body.pw;
  let email=req.body.email;
  let department=req.body.department;
  let rank=req.body.rank;
  let phone=req.body.phone;
  let state=req.body.state;
  let params = [id, department, rank, name, phone, email, state, pw];
  connection.query(
    "INSERT INTO user VALUES (?, ?, ?, ?, ?, ?, ?, ?)", 
    params,
    (err, rows, fields) =>{
      res.send(rows);
      console.log(err);
    });
});

app.delete('/api/hello/:id', (req, res) => {
  
  let params=[req.params.id];
  connection.query("DELETE FROM user WHERE id = (?)", params,
     (err, rows, fields) => {
       res.send(rows);
       console.log(err);
     }
  )
    });
  
app.listen(port, () => console.log(`Listen on port ${port}`));
